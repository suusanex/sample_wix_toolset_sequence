# sample_wix_toolset_sequence

WiX Toolsetでのインストーラサンプル。特にロールバックを含めた動作シーケンスの確認を重視する。

## 動作確認した内容

次の点の動作確認を行った。

1. インストールが成功し、カスタムアクションでInstallType系のプロパティのうちInstallTypeInstallだけが1であること
1. アンインストールが成功し、カスタムアクションでInstallType系のプロパティのうちInstallTypeUnInstallCompleteだけが1であること
1. バージョンの3番目までの値を上げるとアップグレードインストールが成功し、カスタムアクション1回目の呼び出しはInstallType系のプロパティのうちInstallTypeUninstallForUpgradeだけが1であり、2回目の呼び出しはInstallTypeUpgradeだけが1であること。
1. バージョンが同じでもビルドし直すとアップグレードインストールが成功すること。
1. インストール後に同じmsiファイルで再実行すると、バージョンが同一である場合の画面（修復・削除）になること
1. UpgradeInstallFilesCustomActionでエラーが起きるようにしたものでアップグレードインストールを行った場合、新msiのロールバックと、旧msiのロールバックが、両方とも呼ばれること。また、ロールバックのカスタムアクション1回目の呼び出しはInstallType系のプロパティのうちInstallTypeUpgradeだけが1であり、2回目の呼び出しはInstallTypeUninstallForUpgradeだけが1であること。
1. SourceDir等の標準プロパティと、独自に定義したプロパティが、どちらもdeferrdのカスタムアクションへ渡せること。
1. msiexecへのコマンドで、インストール・アンインストール・サイレントインストール・サイレントアンインストールが出来ること。また、それらのログファイルを出力出来ること。

## 動作確認結果の中で注意すべき内容

### アップグレードインストールのロールバックでは、旧msiのロールバック処理でもProductVersionが新msiの値になる

アップグレードで新msiの処理（UpgradeInstallFilesCustomAction）を失敗させた場合、旧msiのロールバック処理（UpgradingUninstallFilesCustomActionRollback）も呼ばれる。しかしこの時、UpgradingUninstallFilesCustomActionRollbackで取得出来るProductVersionプロパティは、新msiの値になっている。処理自体は、旧msiのものが呼ばれている。

